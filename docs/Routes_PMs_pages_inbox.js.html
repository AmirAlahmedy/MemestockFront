<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Routes/PMs/pages/inbox.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Routes/PMs/pages/inbox.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import { BrowserRouter as Router, Route, withRouter } from 'react-router-dom'
import axios from '../../../axios-orders.js';
import '../PMs.css';
import './inbox.css';
class Inbox extends React.Component {

  constructor(props) {
    super(props);
    this.state = {

      Messages: [],
      BlockList: [],
      isLoading: true,
      errors: null

    }

    this.handleClick = this.handleClick.bind(this);
    this.BlockUser = this.BlockUser.bind(this);
    this.blockList = this.blockList.bind(this);
  };


  componentDidMount() {
    console.log(this.props);
    const headers = {
      auth: localStorage.getItem("token")
    }
    const jsondata = { 'mine': true }
    // axios({ method: 'get', url: 'http://18.217.163.16/api/me/pm/?mine=true', headers: { auth: localStorage.getItem("token") } })
    axios.get('me/pm/?mine=true', { "headers": headers })
      .then(response => {
        console.log(response);
        console.log(response.data);


        this.setState({
          Messages: response.data.messages
          ,
          isLoading: false
        });
        console.log(this.state.Messages);

      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
         this.setState({
           Messages,
           isLoading: false
         });
       })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)
        this.setState
          ({
            errors: true,
            isLoading: false
          });
      });
  }
  // deletes a message when Clicked.
  /**
    * sends A Request to delete the message.
    * @function handleClick
    * @param {event} e - On clicking Delete Button.
    */

  handleClick(e) {
    const element = e.target;
    const messageId = element.getAttribute("id");
    console.log(messageId);
    axios.delete(`me/pm/delete?messageId=${messageId}`,
      {
        headers: {
          'Content-Type': 'application/json',
          auth: localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);
        alert("Message Successfully Deleted");



        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        alert("Message Not Found");


      });
  }
  // sending a request to block a user from sending messages to me.
  /**
    * Sends the request to Block user from sending messages.
    * @function BlockUser
    * @param {event} e - Pressing block button.
    */
  BlockUser(e) {
    const element = e.target;
    const blockedUser = element.getAttribute("id");
    axios.post('me/pm/block', {
      blocked: blockedUser,
      block: true
    }, {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);
        alert("Block Succeeded");



        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        if (error.response.data.error === "selfBlockAlertError") {
          alert("Error you're trying to block yourself");
        }
        else if (error.response.data.error === "usersAlreadyOnBlockLists") {
          alert("You've already blocked this user")
        }


      });
  }
    /**
    * Requests the list of blocked users
    * @function blockList
    */
  blockList() {
    this.setState({
      showBlockList: true
    });
    axios.get('me/pm/blocklist',
      {
        headers: {
          'Content-Type': 'application/json',
          auth: localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data)
        this.setState({
          BlockList: res.data.blockList,
          isLoading: false
        });
      })
      .catch(error => {
        console.log(error.response)


      });
  }
  // displaying the inbox messages.
  /**
    * Receiving the messages and displaying them in the inbox.
    * @function getMsgs
    */
  getMsgs() {
    if (this.state.Messages.length === 0) {
      return;
    }
    return this.state.Messages.map((msg) => (
      &lt;div className={`messageWrapper ${msg.isRead ? "read" : "unread"}`}>
        &lt;div className="MessageContainer">
          &lt;h1 className="subjectTitle">Subject: {msg.subject}&lt;/h1>
          &lt;h1 className="senderUsername">From: {msg.sender}&lt;/h1>
          &lt;br />
          &lt;p className="messageContent">{msg.messageBody}&lt;/p>
          &lt;button className="deleteMsg" id={msg._id} type="submit" name="Delete" onClick={this.handleClick}>Delete  &lt;/button>
          &lt;button id={msg.sender} type="submit" name="Block" onClick={this.BlockUser}>Block User&lt;/button>
          &lt;button id={msg._id} type="submit" name="markRead" onClick={this.MarkRead}>Mark Read  &lt;/button>
          &lt;button id={msg._id} type="submit" name="markRead" onClick={this.MarkUnRead}>MarkUnRead  &lt;/button>
          &lt;button data-sender={msg.sender} data-subject={msg.subject} type="submit" onClick={this.reply}>Reply&lt;/button>


        &lt;/div>
      &lt;/div>
    ));
  }
  /**
    * Handles replying on a message
    * @function reply
    * @param {event} - event
    */
  reply(e) {
    const sender = e.target.getAttribute("data-sender");
    const subject = e.target.getAttribute("data-subject");
    window.location.href = `/PM/Compose?sender=${sender}&amp;subject=${subject}`;

  }
   /**
    * Hides block list
    * @function closeBlockList
    */
  closeBlockList(){
    this.setState({
      showBlockList: false
    });
  }
     /**
    * Shows block list
    * @function getBlockList
    */
  getBlockList() {
    if (this.state.BlockList === 0) {
      return;
    }
    return (
      &lt;div className="blockList">
        &lt;button type="button" className="closeBlockList" onClick={this.closeBlockList.bind(this)}>Close&lt;/button>
        {this.state.BlockList.map((blocklist) => (
          &lt;div className="blockeduser">
            &lt;h1 className="blockedusername">{blocklist.blocked}&lt;/h1>
            &lt;button id={blocklist.blocked} type="submit" name="unBlock" onClick={this.unBlockUser}>UnBlockUser  &lt;/button>
            &lt;br />
          &lt;/div>
        ))
        }
      &lt;/div>
    )
  }

  /**
    * Mark all messages as read
    * @function MarkReadAll
    * @param {event} - click event 
    */
  MarkReadAll(e) {
    const element = e.target;
    const messageId = element.getAttribute("id");
    const jsondata = { 'isReadRequest': true }
    console.log(messageId);
    axios.post('me/pm/markreadall', jsondata,
      {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        if (!res.data.success) return;
        let msgs = this.state.Messages.map(msg => {
          msg.isRead = true;
          return msg;
        });
        console.log(msgs);
        this.setState({
          Messages: msgs
        });



      })
      .catch(error => {
        console.log(error)
        alert("Message Not Found");


      });
  }
  /**
    * Mark all messages as unread
    * @function MarkUnReadAll
    * @param {event} - click event 
    */
  MarkUnReadAll(e) {
    const element = e.target;
    const messageId = element.getAttribute("id");
    const jsondata = { 'isReadRequest': false }
    console.log(messageId);
    axios.post('me/pm/markreadall', jsondata,
      {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);

        console.log(res);
        if (!res.data.success) return;
        let msgs = this.state.Messages.map(msg => {
          msg.isRead = false;
          return msg;
        });
        console.log(msgs);
        this.setState({
          Messages: msgs
        });




        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        alert("Message Not Found");


      });
  }
   /**
    * Mark a message as read
    * @function MarkRead
    * @param {event} - click event 
    */
  MarkRead(e) {
    const element = e.target;
    const messageId = element.getAttribute("id");
    const jsondata = { 'isReadRequest': true, "messageId": messageId }
    console.log(messageId);
    axios.put(`me/pm/markread?messageId=${messageId}`, jsondata,
      {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);

        alert("Message Successfully Read");

        const wrapper = element.parentElement.parentElement;
        wrapper.classList.remove("unread");
        wrapper.classList.add("read");
        console.log(wrapper);





        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        alert("Message Not Found");


      });
  }
  /**
    * Mark a message as unread
    * @function MarkUnRead
    * @param {event} - click event 
    */
  MarkUnRead(e) {
    const element = e.target;
    const messageId = element.getAttribute("id");
    const jsondata = { 'isReadRequest': false, "messageId": messageId }
    console.log(messageId);
    axios.put(`me/pm/markread?messageId=${messageId}`, jsondata,
      {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);
        alert("Message Successfully UnRead");
        const wrapper = element.parentElement.parentElement;
        wrapper.classList.remove("read");
        wrapper.classList.add("unread");




        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        alert("Message Not Found");


      });
  }

  // sending a request to block a user from sending messages to me.
  /**
    * Sends the request to Block user from sending messages.
    * @function BlockUser
    * @param {event} e - Pressing block button.
    */
  BlockUser(e) {
    const element = e.target;
    const blockedUser = element.getAttribute("id");
    axios.post('me/pm/block', {
      blocked: blockedUser,
      block: true
    }, {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);
        alert("Block Succeeded");



        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        if (error.response.data.error === "selfBlockAlertError") {
          alert("Error you're trying to block yourself");
          return;
        }
        else if (error.response.data.error === "usersAlreadyOnBlockLists") {
          alert("You've already blocked this user")
          return;
        }


      });
  }

    /**
    * Sends the request to unBlock user from sending messages.
    * @function unBlockUser
    * @param {event} e - Pressing block button.
    */
  unBlockUser(e) {
    const element = e.target;
    const blockedUser = element.getAttribute("id");
    axios.post('me/pm/block', {
      blocked: blockedUser,
      block: false
    }, {
        headers: {
          'Content-Type': 'application/json',
          'auth': localStorage.getItem("token")

        },

      })
      .then(res => {
        console.log(res);
        console.log(res.data);
        alert("unBlock Succeeded");



        //in case sucess..


      })
      .catch(error => {
        console.log(error.response)
        if (error.response.data.error === "canNotBUnblockNonBlockedUser") {
          alert("unblocking not blocked user");
          return;
        }


      });
  }

  render() {
    let msg = this.state.Messages;

    return (
      &lt;div>
        &lt;div className="markRead">
          &lt;button id={msg._id} type="submit" name="markRead" onClick={this.MarkReadAll.bind(this)}>Mark AllRead  &lt;/button>
          &lt;button id={msg._id} type="submit" name="markunRead" onClick={this.MarkUnReadAll.bind(this)}>Mark All Unread  &lt;/button>
          &lt;button id={msg._id} type="submit" name="blockList" onClick={this.blockList.bind(this)}>BlockList &lt;/button>

        &lt;/div>

        {this.getMsgs()}
        {this.state.showBlockList ? this.getBlockList() : null}
      &lt;/div>
      /* &lt;div>
      {msg.map(content=>&lt;div className="subjectTitle">{content.subject}:&lt;/div>)}
      {msg.map(content=>&lt;div className="messageContent">{content.messageBody}&lt;/div>)}
       &lt;/div>
      */


    );
  }
}
export default withRouter(Inbox);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_handleInputChange">_handleInputChange</a></li><li><a href="global.html#_handleOnSubmit">_handleOnSubmit</a></li><li><a href="global.html#BanUser">BanUser</a></li><li><a href="global.html#blockList">blockList</a></li><li><a href="global.html#BlockUser">BlockUser</a></li><li><a href="global.html#CancelCreation">CancelCreation</a></li><li><a href="global.html#cancelEdit">cancelEdit</a></li><li><a href="global.html#cancelSubreddit">cancelSubreddit</a></li><li><a href="global.html#cardViewHandler">cardViewHandler</a></li><li><a href="global.html#checkforpostorcomment">checkforpostorcomment</a></li><li><a href="global.html#checkValidity">checkValidity</a></li><li><a href="global.html#classicViewHandler">classicViewHandler</a></li><li><a href="global.html#closeBlockList">closeBlockList</a></li><li><a href="global.html#closeLogin">closeLogin</a></li><li><a href="global.html#closeRegistration">closeRegistration</a></li><li><a href="global.html#CreateFlair">CreateFlair</a></li><li><a href="global.html#createThread">createThread</a></li><li><a href="global.html#createThreads">createThreads</a></li><li><a href="global.html#createThreadSidebar">createThreadSidebar</a></li><li><a href="global.html#DeleteReport">DeleteReport</a></li><li><a href="global.html#DeleteReportedComment">DeleteReportedComment</a></li><li><a href="global.html#DeleteReportedPost">DeleteReportedPost</a></li><li><a href="global.html#delPost">delPost</a></li><li><a href="global.html#editPost">editPost</a></li><li><a href="global.html#editSubreddit">editSubreddit</a></li><li><a href="global.html#filterList">filterList</a></li><li><a href="global.html#getBlockList">getBlockList</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getFlairs">getFlairs</a></li><li><a href="global.html#getListing">getListing</a></li><li><a href="global.html#getMsgs">getMsgs</a></li><li><a href="global.html#getNotif">getNotif</a></li><li><a href="global.html#getReports">getReports</a></li><li><a href="global.html#getThreads">getThreads</a></li><li><a href="global.html#goTo">goTo</a></li><li><a href="global.html#goToCreatePost">goToCreatePost</a></li><li><a href="global.html#goToCreateSr">goToCreateSr</a></li><li><a href="global.html#gotoMod">gotoMod</a></li><li><a href="global.html#handleAboutChange">handleAboutChange</a></li><li><a href="global.html#handleBlock">handleBlock</a></li><li><a href="global.html#handleChange">handleChange</a></li><li><a href="global.html#handleClick">handleClick</a></li><li><a href="global.html#handledecrement">handledecrement</a></li><li><a href="global.html#handleEdit">handleEdit</a></li><li><a href="global.html#handleFileChange">handleFileChange</a></li><li><a href="global.html#handleFriend">handleFriend</a></li><li><a href="global.html#handleIncrement">handleIncrement</a></li><li><a href="global.html#handleLoginContainerClick">handleLoginContainerClick</a></li><li><a href="global.html#handleNewImage">handleNewImage</a></li><li><a href="global.html#handleNewPasswordChange">handleNewPasswordChange</a></li><li><a href="global.html#handleRegContainerClick">handleRegContainerClick</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#handleUnblock">handleUnblock</a></li><li><a href="global.html#leavemoderation">leavemoderation</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#MarkRead">MarkRead</a></li><li><a href="global.html#MarkReadAll">MarkReadAll</a></li><li><a href="global.html#MarkUnRead">MarkUnRead</a></li><li><a href="global.html#MarkUnReadAll">MarkUnReadAll</a></li><li><a href="global.html#onChange">onChange</a></li><li><a href="global.html#onChangeSr">onChangeSr</a></li><li><a href="global.html#onChangeUser">onChangeUser</a></li><li><a href="global.html#onSave">onSave</a></li><li><a href="global.html#openLogInDialogue">openLogInDialogue</a></li><li><a href="global.html#openRegDialogue">openRegDialogue</a></li><li><a href="global.html#removeReq">removeReq</a></li><li><a href="global.html#reply">reply</a></li><li><a href="global.html#setSR">setSR</a></li><li><a href="global.html#sortHandHot">sortHandHot</a></li><li><a href="global.html#sortHandNew">sortHandNew</a></li><li><a href="global.html#sortHandTop">sortHandTop</a></li><li><a href="global.html#srSubscribe">srSubscribe</a></li><li><a href="global.html#srUnSubscribe">srUnSubscribe</a></li><li><a href="global.html#unBlockUser">unBlockUser</a></li><li><a href="global.html#Unfriend">Unfriend</a></li><li><a href="global.html#userHasLoggedIn">userHasLoggedIn</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue May 07 2019 22:19:47 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
