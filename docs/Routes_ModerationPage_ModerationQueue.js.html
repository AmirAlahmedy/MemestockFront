<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Routes/ModerationPage/ModerationQueue.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Routes/ModerationPage/ModerationQueue.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import { BrowserRouter as Router, Route, withRouter } from 'react-router-dom'
import axios from '../../axios-orders';
import styles from './modQ.css'

class ModerationQueue extends Component {

  constructor(props) {
    super(props);
    this.state = {

      Reports: [],
      isLoading: true,
      errors: null



    }


  };

  componentDidMount() {
    console.log(this.props);
    const headers = {
      auth: localStorage.getItem("token")
    }
    axios.get('Moderator/Reports/', { "headers": headers })
      .then(async (response) => {
        console.log(response);
        console.log(response.data);

        for (const rep of response.data.reports) {
          if (rep.post) continue;
          await axios.get(`/comment/${rep.reportedId}`, { headers: { auth: localStorage.getItem("token") } })
            .then(resp => {
              rep.commentContent = resp.data.content
            })
        }

        this.setState({
          Reports: response.data.reports
          ,
          isLoading: false
        });
        console.log(this.state.Messages);

      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
         this.setState({
           Messages,
           isLoading: false
         });
       })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)
        this.setState
          ({
            errors: true,
            isLoading: false
          });
        if (!error.response) return;
        if (error.response.data === "You are not a moderator to any subreddit") {
          alert("you are not a moderator to any subreddit");
        }
        else if (error.response.data = "No reports") {
          return;
        }
      });
  }
    /**
     * Handles submission
     * @function checkforpostorcomment
     * @param {x} - post or a comment
     * @param {id} - the id of a post or a comment
     */
  checkforpostorcomment(x, id) {
    if (x === true) { return &lt;button className="delBtn" id={id} type="submit" name="deletereportedpost" onClick={this.DeleteReportedPost}>Delete Reported Post&lt;/button> }
    else if (x === false) {
      return &lt;button id={id} className="delBtn" type="submit" name="deletereportedcomment" onClick={this.DeleteReportedComment}>Delete Reported Comment&lt;/button>
    }
  }
  /**
     * Deletes a report
     * @function DeleteReport
     * @param {e} - event
     */
  DeleteReport(e) {

    const element = e.target;
    const container = element.parentElement;
    const reportId = element.getAttribute("id");
    console.log(reportId);
    axios.delete("/Moderator/Reports/" + reportId,
      {
        headers: {
          'Content-Type': 'application/json',
          auth: localStorage.getItem("token")
        },

      })
      .then(response => {
        console.log(response);
        console.log(response.data);
        if(response.data.message === "report deleted"){
          container.remove();
        }

      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
         this.setState({
           Messages,
           isLoading: false
         });
       })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)

        if (error.response.data = "You are not a moderator to any subreddit") {
          alert("you are not a moderator to any subreddit");
        }
        else if (error.response.data = "No reports") {
          alert("there are no reports");
          return;
        }
      });
  }
  /**
     * Deletes a reported comment
     * @function DeleteReportedComment
     * @param {e} - event
     */
  DeleteReportedComment(e) {
    const element = e.target;
    const reportId = element.getAttribute("id");
    axios.delete('Moderator/Comment/' + reportId, {
      headers: {
        'Content-Type': 'application/json',
        auth: localStorage.getItem("token")
      },

    })
      .then(response => {
        console.log(response);
        console.log(response.data);


      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
         this.setState({
           Messages,
           isLoading: false
         });
       })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)

        if (!error.response) return;
        if (error.response.data = "You are not a moderator to any subreddit") {
          alert("you are not a moderator to any subreddit");
        }
        else if (error.response.data = "report doesnt exist") {
          alert("report doesn't exist");
          return;
        }
        else if (error.response.data = "ReportId not valid") {
          alert("report id not valid");
        }
        else if (error.response.data = "This isnt a Comment report") {
          alert("this isn't a comment report");
        }
      });
  }
  /**
     * Deletes a reported post
     * @function DeleteReportedPost
     * @param {e} - event
     */
  DeleteReportedPost(e) {

    const element = e.target;
    const reportId = element.getAttribute("id");
    axios.delete('Moderator/Post/' + reportId, {
      headers: {
        'Content-Type': 'application/json',
        auth: localStorage.getItem("token")
      },

    })
      .then(response => {
        console.log(response);
        console.log(response.data);
        window.location.reload();
      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
         this.setState({
           Messages,
           isLoading: false
         });
       })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)

        if (error.response.data === "You are not a moderator to any subreddit") {
          alert("you are not a moderator to any subreddit");

        }
        else if (error.response.data === "report doesnt exist") {
          alert("report doesn't exist");
          return;
        }
        else if (error.response.data === "ReportId not valid") {
          alert("report not valid");
        }
        else if (error.response.data === "This isnt a post report") {
          alert("this is not a post report");
        }
      });
  }
  /**
     * Handles leaving a moderation
     * @function leavemoderation
     * @param {e} - event
     */
  leavemoderation(e) {
    const element = e.target;
    const SubredditName = element.getAttribute("id");

    axios.delete('/Moderator/leave', {
      SubredditName: SubredditName
    }, {
        headers: {
          'Content-Type': 'application/json',
          auth: localStorage.getItem("token")
        },

      })
      .then(response => {
        console.log(response);
        console.log(response.data);


      })
      // Let's make sure to change the loading state to display the data
      /* .then(Messages => {
      this.setState({
        Messages,
        isLoading: false
      });
      })*/

      // We can still use the `.catch()` method since axios is promise-based
      .catch(error => {
        console.log(error.response)

        if (error.response.data = "user or subreddit not found") {
          alert("user or subreddit not found");
        }

      });
  }




  /**
     * Handles reports
     * @function getReports
     */
  getReports() {
    if (!this.state.Reports.length) { return &lt;p>No Reports found&lt;/p> }
    return this.state.Reports.map((rep) => (

      &lt;div className="repContainer">
        &lt;span className="ReportName">ReportedSubr : {rep.srName}&lt;/span>
        &lt;br />
        &lt;button id={rep.srName} className="leaveMod" type="submit" name="leavemoderation" onClick={this.leavemoderation}>Leave Moderation&lt;/button>
        &lt;p className="ReportDesc">Report Description : {rep.description}&lt;/p>
        &lt;p className="ReportDesc">Report Type : {rep.post ? "Post" : "Comment"}&lt;/p>
        {rep.post ?
          &lt;a href={`/thread/${rep.reportedId}?srName=${rep.srName}`} className="visitPostLink">Visit Post&lt;/a>
          :
          &lt;p>Content: {rep.commentContent}&lt;/p>
        }
        {/*  */}
        &lt;button id={rep._id} className="delBtn" type="submit" name="deleteReport" onClick={this.DeleteReport}>Delete Report&lt;/button>
        {this.checkforpostorcomment(rep.post, rep._id)}
        &lt;hr />



      &lt;/div>

    ));
  }


  render() {

    return (
      &lt;div>

        {this.getReports()}
      &lt;/div>
    );
  }
}

export default ModerationQueue;

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_handleInputChange">_handleInputChange</a></li><li><a href="global.html#_handleOnSubmit">_handleOnSubmit</a></li><li><a href="global.html#BanUser">BanUser</a></li><li><a href="global.html#blockList">blockList</a></li><li><a href="global.html#BlockUser">BlockUser</a></li><li><a href="global.html#CancelCreation">CancelCreation</a></li><li><a href="global.html#cancelEdit">cancelEdit</a></li><li><a href="global.html#cancelSubreddit">cancelSubreddit</a></li><li><a href="global.html#cardViewHandler">cardViewHandler</a></li><li><a href="global.html#checkforpostorcomment">checkforpostorcomment</a></li><li><a href="global.html#checkValidity">checkValidity</a></li><li><a href="global.html#classicViewHandler">classicViewHandler</a></li><li><a href="global.html#closeBlockList">closeBlockList</a></li><li><a href="global.html#closeLogin">closeLogin</a></li><li><a href="global.html#closeRegistration">closeRegistration</a></li><li><a href="global.html#CreateFlair">CreateFlair</a></li><li><a href="global.html#createThread">createThread</a></li><li><a href="global.html#createThreads">createThreads</a></li><li><a href="global.html#createThreadSidebar">createThreadSidebar</a></li><li><a href="global.html#DeleteReport">DeleteReport</a></li><li><a href="global.html#DeleteReportedComment">DeleteReportedComment</a></li><li><a href="global.html#DeleteReportedPost">DeleteReportedPost</a></li><li><a href="global.html#delPost">delPost</a></li><li><a href="global.html#editPost">editPost</a></li><li><a href="global.html#editSubreddit">editSubreddit</a></li><li><a href="global.html#filterList">filterList</a></li><li><a href="global.html#getBlockList">getBlockList</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getFlairs">getFlairs</a></li><li><a href="global.html#getListing">getListing</a></li><li><a href="global.html#getMsgs">getMsgs</a></li><li><a href="global.html#getNotif">getNotif</a></li><li><a href="global.html#getReports">getReports</a></li><li><a href="global.html#getThreads">getThreads</a></li><li><a href="global.html#goTo">goTo</a></li><li><a href="global.html#goToCreatePost">goToCreatePost</a></li><li><a href="global.html#goToCreateSr">goToCreateSr</a></li><li><a href="global.html#gotoMod">gotoMod</a></li><li><a href="global.html#handleAboutChange">handleAboutChange</a></li><li><a href="global.html#handleBlock">handleBlock</a></li><li><a href="global.html#handleChange">handleChange</a></li><li><a href="global.html#handleClick">handleClick</a></li><li><a href="global.html#handledecrement">handledecrement</a></li><li><a href="global.html#handleEdit">handleEdit</a></li><li><a href="global.html#handleFileChange">handleFileChange</a></li><li><a href="global.html#handleFriend">handleFriend</a></li><li><a href="global.html#handleIncrement">handleIncrement</a></li><li><a href="global.html#handleLoginContainerClick">handleLoginContainerClick</a></li><li><a href="global.html#handleNewImage">handleNewImage</a></li><li><a href="global.html#handleNewPasswordChange">handleNewPasswordChange</a></li><li><a href="global.html#handleRegContainerClick">handleRegContainerClick</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#handleUnblock">handleUnblock</a></li><li><a href="global.html#leavemoderation">leavemoderation</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#MarkRead">MarkRead</a></li><li><a href="global.html#MarkReadAll">MarkReadAll</a></li><li><a href="global.html#MarkUnRead">MarkUnRead</a></li><li><a href="global.html#MarkUnReadAll">MarkUnReadAll</a></li><li><a href="global.html#onChange">onChange</a></li><li><a href="global.html#onChangeSr">onChangeSr</a></li><li><a href="global.html#onChangeUser">onChangeUser</a></li><li><a href="global.html#onSave">onSave</a></li><li><a href="global.html#openLogInDialogue">openLogInDialogue</a></li><li><a href="global.html#openRegDialogue">openRegDialogue</a></li><li><a href="global.html#removeReq">removeReq</a></li><li><a href="global.html#reply">reply</a></li><li><a href="global.html#setSR">setSR</a></li><li><a href="global.html#sortHandHot">sortHandHot</a></li><li><a href="global.html#sortHandNew">sortHandNew</a></li><li><a href="global.html#sortHandTop">sortHandTop</a></li><li><a href="global.html#srSubscribe">srSubscribe</a></li><li><a href="global.html#srUnSubscribe">srUnSubscribe</a></li><li><a href="global.html#unBlockUser">unBlockUser</a></li><li><a href="global.html#Unfriend">Unfriend</a></li><li><a href="global.html#userHasLoggedIn">userHasLoggedIn</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue May 07 2019 22:19:47 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
