<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Components/Listings/Listings.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Components/Listings/Listings.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import './Listings.css';
import Thread from '../../Routes/Thread/Thread';
import { BrowserRouter as Router, Switch, Route, Redirect } from 'react-router-dom'
import data from '../../Mocks/threads-data.json';
import axios from '../../axios-orders';
import '../../Sass/styles.scss';
import Subreddit from '../../Routes/Subreddit/Subreddit';
import Aux from '../HOC/Auxiliary';
import Button from '../UI/Button/Button';


let inProduction = true;
let view = null;
class Listings extends Component {



    render() {
        view = this.props.view;
        localStorage.setItem('view', this.props.view);
        return (

            &lt;Router>
                &lt;Aux>
                    &lt;Switch>
                        &lt;Route path="/Home/" exact render={
                            props => {
                                return &lt;Threads listingUpdater={this.props.listingUpdater} view={this.props.view} sort={this.props.sort} />
                            }
                        } />
                        &lt;Route path="/r" component={Subreddit} />
                    &lt;/Switch>

                &lt;/Aux>
            &lt;/Router>


        );

    }
    token = this.props.authToken;

}
const token = Listings.token;

class Threads extends Component {
    state = {
        threads: [],
        sort: 'new',
    }

    startPosition = { startPosition: 0 };
    headers = {
        'Content-Type': 'application/json',
        'auth': localStorage.getItem('token')
    }
    componentDidMount = () => {
        console.log(this.props.match);
        console.log(token);
        console.log(localStorage.getItem('token'));

        axios.get(`/me/listing?type=${this.props.sort}&amp;_id=0&amp;votes=0&amp;hotindex=0`, { headers: this.headers })
            .then(response => {
                
                // response.data.posts.sort((p1, p2) => {
                //     const d1 = new Date(p1.postDate);
                //     const d2 = new Date(p2.postDate);
                //     return d1.getTime() - d2.getTime();
                // })
                this.reqThreads = response.data;
                this.setState({
                    reqThreads: response.data,
                    lastID: response.data.posts[response.data.posts.length-1]._id,
                    votes: response.data.posts[response.data.posts.length-1].votes,
                    
                });

            })
            .catch(error => {

            })
        this.props.listingUpdater(this.getListing.bind(this));
        window.addEventListener("scroll", () => {
            if (document.documentElement.scrollTop + window.innerHeight === document.documentElement.offsetHeight) {

                return axios.get(`/me/listing?type=${this.props.sort}&amp;_id=${this.state.lastID}&amp;votes=${this.state.votes}&amp;hotindex=${0}`, { headers: this.headers })
                    .then(response => {
                        console.log(response);
                        this.reqThreads.posts = this.reqThreads.posts.concat(response.data.posts);
                        response.data.posts = this.reqThreads.posts;
                        this.setState({
                            reqThreads: response.data,
                            lastID: response.data.posts[response.data.posts.length-1]._id,
                            votes: response.data.posts[response.data.posts.length-1].votes,
                        });

                    })
                    .catch(error => {

                    })

            }
        })


    }


    createSubHand = () => {
        console.log('create community');
        return (&lt;Redirect to="/create-subreddit/" />);

    }

    /**
     * For generating threads from a mock service
     * @function createThread
     * @param {object} - object of the mocked thread.
     */
    createThread = thread => &lt;Thread
        // key={thread._id}
        // username={thread.creatorUsername}
        subreddit={thread.subredditName}
        title={thread.title}
        conten t={thread.body}
        view={this.props.view}
        upvotes={thread.votes}
    />;
    // Ya Amiir....
    //Aywa 3ayyez eh?

    /**
     * For generating threads from a mock service
     * @function getThreads
     * @param {view} - the listings view, whether cards or calssic.
     */
    getThreads(view) {
        if (!this.state.reqThreads || !this.state.reqThreads.posts) return;
        let posts = inProduction ? this.state.reqThreads.posts : data.threads;
        return posts.map(thr => &lt;Thread
            id={thr._id}
            username={thr.creatorUsername}
            subreddit={thr.subredditName}
            title={thr.title}
            content={thr.body}
            view={view}
            upvotes={thr.votes}
            isSpoiler={thr.spoiler}
            image={thr.postFile === "none" ? null : thr.postFile}
        />)
    }

    /**
     * For generating threads from a mock service
     * @function createThreads
     * @param {array} - array of the mocked threads
     */
    createThreads = Threads => Threads.map(this.createThread);


    /**
     * Redirects to create post route
     * @function goToCreatePost
     */
    goToCreatePost() {
        window.location.href = "/CreatePost/";
    }

    /**
     * Redirects to create subreddit route
     * @function goToCreateSr
     */
    goToCreateSr() {
        window.location.href = "/create-subreddit/";
    }

    
    /**
     * For generating threads from a mock service
     * @function getListing
     * @param {sort} - criteria on which threads are sorted
     */
    getListing(sort) {
        console.log("sort: ", sort);
        if (inProduction === true &amp;&amp; localStorage.getItem('inProduction')) {
            //It's done ha, zbat l configuration bta3ha b2a
            axios.get(`/me/listing?type=${sort}&amp;_id=0&amp;votes=0&amp;hotindex=0`, { headers: this.headers })
                .then(response => {
                    this.reqThreads = response.data;
                    this.setState({ reqThreads: response.data });
                })
                .catch(error => {

                })
        } else {

            this.setState({ reqThreads: data.threads });
            let thrds = this.createThreads(data.threads);
            this.setState({ threads: thrds });
        }
    }
    render() {

        return (
            &lt;Aux>
                &lt;div className='listingsContainer'>
                    {this.getThreads(this.props.view)}
                &lt;/div>
                &lt;sidebar className='sidebar'>
                    &lt;Button clicked={this.goToCreatePost} id='Cp'>Create Post&lt;/Button>
                    &lt;Button clicked={this.goToCreateSr.bind(this)} id='Sr'> Create Community&lt;/Button>
                &lt;/sidebar>
            &lt;/Aux>

        )
    }
}

const Thr = Threads;
export {
    Listings,
    Thr
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#_handleInputChange">_handleInputChange</a></li><li><a href="global.html#_handleOnSubmit">_handleOnSubmit</a></li><li><a href="global.html#BanUser">BanUser</a></li><li><a href="global.html#blockList">blockList</a></li><li><a href="global.html#BlockUser">BlockUser</a></li><li><a href="global.html#CancelCreation">CancelCreation</a></li><li><a href="global.html#cancelEdit">cancelEdit</a></li><li><a href="global.html#cancelSubreddit">cancelSubreddit</a></li><li><a href="global.html#cardViewHandler">cardViewHandler</a></li><li><a href="global.html#checkforpostorcomment">checkforpostorcomment</a></li><li><a href="global.html#checkValidity">checkValidity</a></li><li><a href="global.html#classicViewHandler">classicViewHandler</a></li><li><a href="global.html#closeBlockList">closeBlockList</a></li><li><a href="global.html#closeLogin">closeLogin</a></li><li><a href="global.html#closeRegistration">closeRegistration</a></li><li><a href="global.html#CreateFlair">CreateFlair</a></li><li><a href="global.html#createThread">createThread</a></li><li><a href="global.html#createThreads">createThreads</a></li><li><a href="global.html#createThreadSidebar">createThreadSidebar</a></li><li><a href="global.html#DeleteReport">DeleteReport</a></li><li><a href="global.html#DeleteReportedComment">DeleteReportedComment</a></li><li><a href="global.html#DeleteReportedPost">DeleteReportedPost</a></li><li><a href="global.html#delPost">delPost</a></li><li><a href="global.html#editPost">editPost</a></li><li><a href="global.html#editSubreddit">editSubreddit</a></li><li><a href="global.html#filterList">filterList</a></li><li><a href="global.html#getBlockList">getBlockList</a></li><li><a href="global.html#getCurrentUser">getCurrentUser</a></li><li><a href="global.html#getFlairs">getFlairs</a></li><li><a href="global.html#getListing">getListing</a></li><li><a href="global.html#getMsgs">getMsgs</a></li><li><a href="global.html#getNotif">getNotif</a></li><li><a href="global.html#getReports">getReports</a></li><li><a href="global.html#getThreads">getThreads</a></li><li><a href="global.html#goTo">goTo</a></li><li><a href="global.html#goToCreatePost">goToCreatePost</a></li><li><a href="global.html#goToCreateSr">goToCreateSr</a></li><li><a href="global.html#gotoMod">gotoMod</a></li><li><a href="global.html#handleAboutChange">handleAboutChange</a></li><li><a href="global.html#handleBlock">handleBlock</a></li><li><a href="global.html#handleChange">handleChange</a></li><li><a href="global.html#handleClick">handleClick</a></li><li><a href="global.html#handledecrement">handledecrement</a></li><li><a href="global.html#handleEdit">handleEdit</a></li><li><a href="global.html#handleFileChange">handleFileChange</a></li><li><a href="global.html#handleFriend">handleFriend</a></li><li><a href="global.html#handleIncrement">handleIncrement</a></li><li><a href="global.html#handleLoginContainerClick">handleLoginContainerClick</a></li><li><a href="global.html#handleNewImage">handleNewImage</a></li><li><a href="global.html#handleNewPasswordChange">handleNewPasswordChange</a></li><li><a href="global.html#handleRegContainerClick">handleRegContainerClick</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#handleUnblock">handleUnblock</a></li><li><a href="global.html#leavemoderation">leavemoderation</a></li><li><a href="global.html#logout">logout</a></li><li><a href="global.html#MarkRead">MarkRead</a></li><li><a href="global.html#MarkReadAll">MarkReadAll</a></li><li><a href="global.html#MarkUnRead">MarkUnRead</a></li><li><a href="global.html#MarkUnReadAll">MarkUnReadAll</a></li><li><a href="global.html#onChange">onChange</a></li><li><a href="global.html#onChangeSr">onChangeSr</a></li><li><a href="global.html#onChangeUser">onChangeUser</a></li><li><a href="global.html#onSave">onSave</a></li><li><a href="global.html#openLogInDialogue">openLogInDialogue</a></li><li><a href="global.html#openRegDialogue">openRegDialogue</a></li><li><a href="global.html#removeReq">removeReq</a></li><li><a href="global.html#reply">reply</a></li><li><a href="global.html#setSR">setSR</a></li><li><a href="global.html#sortHandHot">sortHandHot</a></li><li><a href="global.html#sortHandNew">sortHandNew</a></li><li><a href="global.html#sortHandTop">sortHandTop</a></li><li><a href="global.html#srSubscribe">srSubscribe</a></li><li><a href="global.html#srUnSubscribe">srUnSubscribe</a></li><li><a href="global.html#unBlockUser">unBlockUser</a></li><li><a href="global.html#Unfriend">Unfriend</a></li><li><a href="global.html#userHasLoggedIn">userHasLoggedIn</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue May 07 2019 22:19:47 GMT+0200 (Eastern European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
